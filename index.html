<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>發一崇德台中道場資訊網</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
  <meta name="theme-color" content="#7e57c2">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon-192.png">

  <style>
    html, body {
      margin:0; padding:0;
      width:100%; height:100%;
      display:flex; justify-content:center; align-items:center;
      font-family:'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg,#d1c4e9,#b39ddb,#9575cd,#7e57c2);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      overflow:hidden;
    }
    @keyframes gradientBG{
      0%{background-position:0% 50%}
      50%{background-position:100% 50%}
      100%{background-position:0% 50%}
    }
    .glass-container {
      backdrop-filter: blur(15px);
      background: rgba(255,255,255,0.1);
      border-radius:25px;
      border:1px solid rgba(255,255,255,0.2);
      padding:2em;
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      color:white;
      max-width:350px;
      width:90%;
      box-shadow:0 0 40px rgba(0,0,0,0.3);
      transition: opacity 0.5s ease;
    }
    .spinner{
      width:50px; height:50px;
      border:6px solid rgba(255,255,255,0.3);
      border-top:6px solid #b39ddb;
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:1em;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
    #install-tip{ font-size:1.1em; margin-top:1em; line-height:1.5; }
    .action-button {
      background: rgba(255,255,255,0.2);
      color:white;
      border:1px solid rgba(255,255,255,0.4);
      padding:12px 25px;
      border-radius:15px;
      font-size:1em;
      cursor:pointer;
      margin-top:1em;
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
      width:80%;
    }
    .action-button:hover{
      background: rgba(179,157,219,0.3);
      border-color: rgba(255,255,255,0.6);
    }
  </style>
</head>
<body>
<div class="glass-container">
  <div class="spinner"></div>
  <div id="message">正在檢查裝置與瀏覽器...</div>
  <div id="install-tip"></div>
  <button id="open-site" class="action-button" style="display:none;">進入網站</button>
  <button id="install-btn" class="action-button" style="display:none;">安裝到主畫面</button>
</div>

<script>
const SITE_URL = "https://sites.google.com/view/fycd-tc/";
let deferredPrompt;

// 檢查是否為 PWA 模式
function isPWA() {
  return window.matchMedia('(display-mode: standalone)').matches ||
         window.matchMedia('(display-mode: fullscreen)').matches ||
         window.navigator.standalone === true;
}

// 自動跳轉到網站
function goToSite() {
  window.location.href = SITE_URL;
}

// 顯示安裝與跳轉提示
function showInstallUI() {
  const container = document.querySelector('.glass-container');
  const message = document.getElementById("message");
  const tip = document.getElementById("install-tip");
  const btnOpen = document.getElementById("open-site");
  const btnInstall = document.getElementById("install-btn");

  // 偵測瀏覽器
  const ua = navigator.userAgent.toLowerCase();
  let browserTip = "";
  if (/iphone|ipad|ipod/.test(ua) && /safari/.test(ua) && !/crios/.test(ua)) {
    browserTip = "📱 iOS Safari：點擊下方「分享」→選擇「加到主畫面」";
    btnInstall.style.display="none";
  } else if (/android/.test(ua) && /chrome/.test(ua) || /edg/.test(ua)) {
    browserTip = "📲 點擊「安裝到主畫面」按鈕安裝 PWA";
    btnInstall.style.display="block";
  } else if (/firefox/.test(ua)) {
    browserTip = "🦊 Firefox 暫不支援 PWA，可加入書籤或固定分頁";
    btnInstall.style.display="none";
  } else {
    browserTip = "ℹ️ 請使用支援 PWA 的瀏覽器安裝應用程式";
    btnInstall.style.display="none";
  }

  message.innerHTML = "您可以安裝此網站為應用程式：";
  tip.innerHTML = browserTip;

  btnOpen.style.display = "block";
  btnOpen.onclick = goToSite;
}

// 監聽 beforeinstallprompt
window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  const btnInstall = document.getElementById("install-btn");
  btnInstall.style.display = "block";
  btnInstall.onclick = async () => {
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    deferredPrompt = null;
  };
});

// DOM 載入後執行
document.addEventListener("DOMContentLoaded", ()=>{
  if(isPWA()){
    // PWA 已啟動 → 直接跳轉網站
    goToSite();
  } else {
    // 非 PWA → 顯示安裝提示
    showInstallUI();
  }
});
</script>
</body>
</html>
