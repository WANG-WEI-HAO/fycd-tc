<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>ç™¼ä¸€å´‡å¾·å°ä¸­é“å ´è³‡è¨Šç¶²</title>

<!-- Viewport and fullscreen settings for PWA -->
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
<meta name="theme-color" content="#7e57c2">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

<link rel="manifest" href="manifest.json">
<link rel="icon" href="icons/icon-192.png">

<style>
/* Base Styles */
html, body{
  margin:0; padding:0;
  width:100%; height:100%;
  display:flex; justify-content:center; align-items:center;
  font-family:'Segoe UI', Roboto, sans-serif;
  background: linear-gradient(135deg,#d1c4e9,#b39ddb,#9575cd,#7e57c2);
  background-size: 400% 400%;
  animation: gradientBG 15s ease infinite;
  overflow:hidden;
}

/* Glass Container for main content */
.glass-container{
  backdrop-filter: blur(15px);
  background: rgba(255,255,255,0.1);
  border-radius: 25px;
  border: 1px solid rgba(255,255,255,0.2);
  padding: 2em;
  display:flex; flex-direction:column; align-items:center;
  text-align:center;
  color:white;
  max-width:350px; width:90%;
  box-shadow: 0 0 40px rgba(0,0,0,0.3);
}

/* Spinner Styles */
.spinner{
  width:50px; height:50px;
  border:6px solid rgba(255,255,255,0.3);
  border-top:6px solid #b39ddb;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin-bottom:1em;
}

/* Custom Message Box Styles (replaces alert) */
.message-box {
    display: none; /* Hidden by default */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(15px);
    border-radius: 25px;
    border: 1px solid rgba(255, 255, 255, 0.4);
    padding: 2em;
    z-index: 1000;
    text-align: center;
    width: 80%;
    max-width: 300px;
    color: white;
}

.message-box-content {
    margin-bottom: 1em;
}

/* Other Animations and styles */
@keyframes gradientBG{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}
@keyframes spin{to{transform:rotate(360deg)}}

#message{font-size:1.2em; margin-bottom:1.5em;}

.action-button{
  background: rgba(255,255,255,0.2);
  color:white;
  border:1px solid rgba(255,255,255,0.4);
  padding:12px 25px;
  border-radius:15px;
  font-size:1em;
  cursor:pointer;
  margin:0.5em 0;
  backdrop-filter: blur(5px);
  transition: all 0.3s ease;
  width:80%;
}
.action-button:hover{
  background: rgba(179,157,219,0.3);
  border-color: rgba(255,255,255,0.6);
  transform: scale(1.05);
}
</style>
</head>
<body>
<div class="glass-container">
Â  <div id="message">è¼‰å…¥ä¸­...</div>
Â  <div class="spinner"></div>
</div>

<!-- Custom message box for better user experience -->
<div class="message-box" id="message-box">
    <div class="message-box-content" id="message-content"></div>
    <button class="action-button" onclick="closeMessageBox()">ç¢ºèª</button>
</div>

<script>
const SITE_URL = 'https://taichung-faith.org';
const container = document.querySelector('.glass-container');
const messageBox = document.getElementById('message-box');
const messageContent = document.getElementById('message-content');

// Function to show a custom message box
function showMessageBox(message) {
    messageContent.innerHTML = message;
    messageBox.style.display = 'block';
}

// Function to close the custom message box
function closeMessageBox() {
    messageBox.style.display = 'none';
}

function detectClient(){
Â  const ua = navigator.userAgent;
Â  const isIOS = /iPhone|iPad|iPod/i.test(ua);
Â  const isAnd = /Android/i.test(ua);
Â  const isChr = /Chrome\/\d+/i.test(ua)&&!ua.includes('Edg/');
Â  const isEdg = /Edg\/\d+/i.test(ua);
Â  const isFx = /Firefox\/\d+/i.test(ua)&&!ua.includes('Seamonkey');
Â  const isSaf = /Safari\/\d+/i.test(ua)&&!isChr&&!isEdg;
Â  const inPWA = window.matchMedia('(display-mode: standalone)').matches;
Â  return {isIOS,isAnd,isChr,isEdg,isFx,isSaf,inPWA};
}

function safeOpen(url){
Â  try{
Â  Â  const newWin = window.open(url,'_blank');
Â  Â  if(!newWin) window.location.href = url;
Â  }catch(e){window.location.href = url;}
}

window.addEventListener('load',()=>{
Â  const c = detectClient();
Â  const msg = document.getElementById('message');
Â  const spinner = document.querySelector('.spinner');

Â  let hint='ğŸ“² å»ºè­°å®‰è£è‡³æ¡Œé¢ï¼Œäº«å—å…¨è¢å¹•é«”é©—ã€‚';
Â  if(c.isIOS && c.isSaf) {
      hint='ğŸ“² åœ¨ Safari åº•éƒ¨ã€Œåˆ†äº«ã€â†’ã€åŠ å…¥ä¸»ç•«é¢ã€å®‰è£ã€‚';
  } else if(c.isAnd && (c.isChr||c.isEdg)) {
      hint='ğŸ“² é»ç¶²å€åˆ—å³å´ã€Œå®‰è£åœ–ç¤ºã€æˆ–é¸å–®ã€ŒåŠ å…¥ä¸»ç•«é¢ã€ã€‚';
  } else if(c.isFx) {
      hint='ğŸ¦Š Firefox å¯ç”¨ã€Œâ‹® é¸å–®â†’å®‰è£ã€æˆ–æ‰‹å‹•åŠ å…¥æ›¸ç±¤ã€‚';
  }

Â  msg.innerHTML=`ğŸ‘‹ æ­¡è¿å®‰è£å°ä¸­é“å ´è³‡è¨Šç¶²<br><br>${hint}<br>å°‡åœ¨<strong>20 ç§’</strong>å¾Œè‡ªå‹•è·³è½‰ç¶²ç«™ï¼Œ<br>æˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•ç«‹å³å‰å¾€ã€‚`;
Â  spinner.style.display='none';

Â  const btn=document.createElement('button');
Â  btn.className='action-button';
Â  btn.textContent='ç«‹å³å‰å¾€ç¶²ç«™';
Â  btn.onclick = ()=> safeOpen(SITE_URL);
Â  container.appendChild(btn);

Â  if(c.isIOS && c.isSaf){
Â  Â  const iosBtn=document.createElement('button');
Â  Â  iosBtn.className='action-button';
Â  Â  iosBtn.textContent='å®‰è£åˆ°ä¸»ç•«é¢';
Â  Â  // Use the custom message box instead of alert()
Â  Â  iosBtn.onclick = ()=> showMessageBox('è«‹é»é¸ Safari åº•éƒ¨ã€Œåˆ†äº«ã€â†’ã€ŒåŠ å…¥ä¸»ç•«é¢ã€å³å¯å®‰è£');
Â  Â  container.appendChild(iosBtn);
Â  }

Â  let deferredPrompt;
Â  window.addEventListener('beforeinstallprompt', e=>{
Â  Â  e.preventDefault();
Â  Â  deferredPrompt = e;
Â  Â  const installBtn=document.createElement('button');
Â  Â  installBtn.textContent='å®‰è£å°ä¸­é“å ´è³‡è¨Šç¶²';
Â  Â  installBtn.className='action-button';
Â  Â  installBtn.onclick = async()=>{
Â  Â  Â  try { await deferredPrompt.prompt(); } catch(err){ console.warn('Prompt è¢«ç¦æ­¢', err); }
Â  Â  Â  const choice = await deferredPrompt.userChoice;
Â  Â  Â  console.log(`ä½¿ç”¨è€…é¸æ“‡: ${choice.outcome}`);
Â  Â  Â  deferredPrompt = null;
Â  Â  };
Â  Â  container.appendChild(installBtn);
Â  });

Â  setTimeout(()=>{ if(!document.hidden) window.location.href=SITE_URL; },20000);

  // --- Service Worker Registration ---
  // Note: This code enables offline functionality and updates.
  // It may fail in certain environments (e.g., local file:// or sandbox)
  // due to browser security restrictions. For production on a web server,
  // this is the correct way to register a Service Worker.
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js').then(reg => {
      console.log('Service Worker è¨»å†ŠæˆåŠŸ:', reg.scope);

      // Listen for updates and show a notification
      reg.addEventListener('updatefound', () => {
        const newSW = reg.installing;
        if (newSW) {
          newSW.addEventListener('statechange', () => {
            if (newSW.state === 'installed' && navigator.serviceWorker.controller) {
              const notice = document.createElement('div');
              notice.id = 'update-notice';
              notice.textContent = 'ğŸ”„ æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œé»æ“Šæ›´æ–°ï¼';
              notice.onclick = () => window.location.reload();
              document.body.appendChild(notice);
            }
          });
        }
      });
    }).catch(err => {
      console.error('Service Worker è¨»å†Šå¤±æ•—:', err);
    });
  }
</script>
</body>
</html>
